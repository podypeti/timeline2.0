<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>History Timeline</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>

  <!-- Timeline Canvas -->


<div id="timelineContainer">
  <!-- Top toolbar -->
  <div class="timelineToolbar">
    <details class="legend-panel" open>
      <summary>Categories</summary>
      <div class="legend-content">
        <input id="legendSearch" type="search" placeholder="Search categories…" />
        <div id="legend"></div>
      </div>
    </details>

    <!-- NEW: Event search -->
    <input
      id="eventSearch"
      class="toolbarSearch"
      type="search"
      placeholder="Search events… (title, text, date, group)"
      aria-label="Search events"
    />

    <div class="toolbarSpacer"></div>

    <div class="zoomGroup">
      <button id="zoomOut" class="ghost" title="Zoom out">−</button>
      <button id="resetZoom" class="ghost" title="Reset zoom">Reset</button>
      <button id="zoomIn"  class="ghost" title="Zoom in">+</button>
    </div>
  </div>

  <!-- Canvas -->
  <canvas id="timelineCanvas" width="1200" height="560" aria-label="Timeline"></canvas>
</div>

  <!-- Details Panel -->
  <aside id="detailsPanel" class="details hidden" role="dialog" aria-modal="true">
    <button id="detailsClose" class="close" aria-label="Close">×</button>
    <div id="detailsContent"></div>
  </aside>

  <!-- Pan Slider -->
  <div class="panSliderBar">
    <span class="panLabel">Center:</span>
    <input id="panSlider" type="range" />
    <span id="panValue" class="panValue">1 CE</span>
  </div>

  <!-- Scripts -->
  <script src="./timeline.js"></script>
  <script>
    const CSV_URL = new URL('timeline-data.csv', window.location.href).toString();

    async function start() {
      try {
        const rows = await loadCsv(CSV_URL);
        events = rows;
        buildLegend();
        initScaleAndPan();
        draw();
      } catch (err) {
        console.error('[timeline] failed to load CSV', err);
        const panel = document.getElementById('detailsPanel');
        const content = document.getElementById('detailsContent');
        content.innerHTML = '<p><strong>Error:</strong> Could not load CSV. Check URL and CORS.</p>';
        panel.classList.remove('hidden');
      }
    }

    start(); // Call initialization
  </script>
</body>
</html>
